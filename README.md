# CMSC818J Assignment 2 - HPCG Benchmark

This is a benchmark that could be used to complete Assignment 2. This benchmark is called HPCG, and tests the performance of a sparse scientific computing workload called the Conjugate Gradient Method. While it is not necessary to understand the kernel, you can learn more about it [here](https://en.wikipedia.org/wiki/Conjugate_gradient_method).

## Logging into Junkfood
This benchmark requires access to a linux environment that can execute perf. The officially supported environment is junkfood. If you have access
to hardware running linux that has perf, you can use it, but the TA may be unable to help you. Use at your own risk.

:warning: **You must login to a specific junkfood host for perf to work**. The junkfood server is made up of three hosts: two physical servers (krispykreme and cheezit) and a VM (biggulp). Logging on using `ssh <username>@junkfood.cs.umd.edu` will give you a 1/3 chance of landing on the VM biggulp. If you logon to the VM, **perf will not work**. This is because the perf hardware counter events won't work on a virtual machine, you need access to the hardware itself.

So, you must ***specifically log on to krispykreme or cheezit***. Do this via the following
```bash
ssh <username>@krispykreme.cs.umd.edu
```
or
```bash
ssh <username>@cheezit.cs.umd.edu
```

## Building the Benchmark
Once you have logged into krispykreme or cheezit, clone this repository:
```bash
git clone git@github.com:ryansynk/cmsc818j_fall2023_Assignment2_hpcg.git
```
Perform the following commands to build the benchmark itself:
```bash
cd cmsc818j_fall2023_Assignment2_hpcg
mkdir build
cd build
../configure Linux_Serial
make
```
If this succeeds, there should now be a directory in `build`, called `bin`. Inside the `bin` directory there will be an executable,
`xhpcg`. Run the executable with perf:
```bash
cd bin
perf stat ./xhpcg
```
This will run for  a while - around 1-2 minutes. It shouldn't produce any output until it completes. When the program is finished executing, you should see a printout from `perf`. Additionally, there will be a `.txt` file containing more information generated by the benchmark.

## Debugging

If you run `perf stat ./xhpcg` and see an output that looks like this
```bash
Performance counter stats for './xhpcg':

              1.21 msec task-clock:u                     #    0.663 CPUs utilized          
                 0      context-switches:u               #    0.000 /sec                   
                 0      cpu-migrations:u                 #    0.000 /sec                   
               104      page-faults:u                    #   86.277 K/sec                  
   <not supported>      cycles:u                                                    
   <not supported>      instructions:u                                              
   <not supported>      branches:u                                                  
   <not supported>      branch-misses:u                                             

       0.001818965 seconds time elapsed

       0.000000000 seconds user
       0.001644000 seconds sys

```
It's probably because you are on the VM. Does your terminal say `<username>@biggulp: `? This means you are on the VM. To fix, you must log out, and then log back in by using
```bash
ssh <username>@krispykreme.cs.umd.edu
```
or
```bash
ssh <username>@cheezit.cs.umd.edu
```

## Further information

Check out  the website  http://www.hpcg-benchmark.org/ for more background info on the benchmark itself.
